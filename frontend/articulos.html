<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artículos de Tecnología | Sistema de Gestión</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><style>circle{fill:%232d3748;}path{fill:%234fd1c5;}</style></defs><circle cx='50' cy='50' r='45'/><path d='M50,30a15,15,0,1,0,15,15A15,15,0,0,0,50,30Zm0,25A10,10,0,1,1,60,45,10,10,0,0,1,50,55Z'/><path d='M50,65a30,30,0,0,0-30,30H80A30,30,0,0,0,50,65Zm0,5A25,25,0,0,1,75,95H25A25,25,0,0,1,50,70Z'/></svg>" type="image/svg+xml">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav class="navbar">
                <div class="logo">Sistema de Usuarios</div>
                <ul class="nav-links">
                    <li><a href="dashboard.html" class="active">Dashboard</a></li>
                    <li><a href="gestion-usuarios.html">Gestión de Usuarios</a></li>
                    <li><a href="articulos.html" class="active">Articulos</a></li>
                    <li><a href="acercade.html" class="active">Acerca De</a></li>
                </ul>
                <div class="user-info">
                    <span id="userName">Usuario</span>
                    <button class="btn btn-secondary" id="logoutBtn">Cerrar Sesión</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="container">
        <!-- Hero Section -->
        <!-- Hero Section -->
<section class="articles-hero">
    <div class="hero-content">
        <h1>Artículos de Tecnología</h1>
        <p>Gestiona los artículos de la tienda - CRUD Completo</p>
        
        <div class="hero-actions">
            <button class="btn btn-primary" id="addArticleBtn">
                <i class="fas fa-plus"></i> Agregar Artículo
            </button>
            <button class="btn btn-secondary" id="refreshArticlesBtn">
                <i class="fas fa-sync-alt"></i> Actualizar
            </button>
        </div>
        
        <div class="hero-stats">
            <div class="stat">
                <i class="fas fa-boxes"></i>
                <span id="totalArticles">Cargando...</span>
            </div>
            <div class="stat">
                <i class="fas fa-dollar-sign"></i>
                <span id="totalValue">Cargando...</span>
            </div>
            <div class="stat">
                <i class="fas fa-layer-group"></i>
                <span id="totalStock">Cargando...</span>
            </div>
        </div>
    </div>
</section>

<!-- Buscador -->
<section class="search-section">
    <div class="container">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Buscar artículo por nombre..." 
                   class="search-input">
            <button id="searchBtn" class="btn btn-primary">
                <i class="fas fa-search"></i> Buscar
            </button>
            <button id="clearSearchBtn" class="btn btn-secondary">
                <i class="fas fa-times"></i> Limpiar
            </button>
        </div>
    </div>
</section>

        

        <!-- Lista de artículos -->
        <section class="articles-list"><!-- Lista de artículos -->
<section class="articles-list">
    <div class="container">
        <div class="articles-header">
            <h2>Catálogo de Artículos</h2>
            <div class="sort-options">
                <select class="sort-select" id="sortSelect">
                    <option value="id">Ordenar por: ID</option>
                    <option value="nombre">Ordenar por: Nombre</option>
                    <option value="precio_asc">Ordenar por: Precio (Asc)</option>
                    <option value="precio_desc">Ordenar por: Precio (Desc)</option>
                    <option value="stock">Ordenar por: Stock</option>
                </select>
            </div>
        </div>

        <div class="alert alert-info" id="messageAlert" style="display: none;"></div>

        <div class="articles-grid" id="articlesGrid">
            <!-- Los artículos se cargarán dinámicamente aquí -->
        </div>

        <!-- Mensaje cuando no hay artículos -->
        <div class="no-articles" id="noArticlesMessage" style="display: none;">
            <i class="fas fa-box-open" style="font-size: 3rem; color: #95a5a6; margin-bottom: 1rem;"></i>
            <h3>No hay artículos disponibles</h3>
            <p>Agrega tu primer artículo haciendo clic en el botón "Agregar Artículo"</p>
        </div>
    </div>
</section>
        <!-- Newsletter -->
        <section class="newsletter-section">
            <div class="newsletter-card">
                <i class="fas fa-envelope-open-text"></i>
                <h3>Suscríbete a mi Newsletter</h3>
                <p>Recibe los últimos artículos sobre tecnología directamente en tu correo</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Tu correo electrónico" required>
                    <button type="submit" class="btn btn-primary">Suscribirse</button>
                </form>
                <p class="newsletter-note">Sin spam, solo contenido de valor. Puedes darte de baja cuando quieras.</p>
            </div>
        </section>
        <!-- Modal para agregar/editar artículo -->
<div class="modal" id="articleModal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 id="modalTitle">Agregar Artículo</h2>
            <button class="close-modal" id="closeModal">&times;</button>
        </div>
        <form id="articleForm">
            <input type="hidden" id="articleId">
            
            <div class="form-group">
                <label for="articleName">Nombre del Artículo *</label>
                <input type="text" id="articleName" class="form-control" required 
                       maxlength="50" placeholder="Ej: HTML y CSS Pro">
            </div>
            
            <div class="form-group">
                <label for="articleDescription">Descripción *</label>
                <textarea id="articleDescription" class="form-control" rows="3" required
                          maxlength="250" placeholder="Descripción del artículo..."></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="articleStock">Existencias *</label>
                    <input type="number" id="articleStock" class="form-control" 
                           min="0" required placeholder="0">
                </div>
                <div class="form-group">
                    <label for="articlePrice">Precio ($) *</label>
                    <input type="number" id="articlePrice" class="form-control" 
                           min="0" step="0.01" required placeholder="0.00">
                </div>
            </div>
            
            <div class="form-group">
                <label for="articleCategory">Categoría *</label>
                <select id="articleCategory" class="form-control" required>
                    <option value="">Seleccionar categoría...</option>
                    <!-- Las categorías se cargarán dinámicamente -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="articlePhoto">URL de la Imagen</label>
                <input type="text" id="articlePhoto" class="form-control" 
                       placeholder="Ej: img/html_css.jpg">
                <small class="form-text">Dejar vacío para usar imagen por defecto</small>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelBtn">Cancelar</button>
                <button type="submit" class="btn btn-primary" id="saveBtn">Guardar Artículo</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal de confirmación para eliminar -->
<div class="modal" id="deleteModal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2>Confirmar Eliminación</h2>
            <button class="close-modal" id="closeDeleteModal">&times;</button>
        </div>
        <div class="modal-body">
            <p>¿Está seguro de que desea eliminar el artículo "<span id="deleteArticleName"></span>"?</p>
            <p class="text-danger"><i class="fas fa-exclamation-triangle"></i> Esta acción no se puede deshacer.</p>
        </div>
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">Cancelar</button>
            <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Eliminar</button>
        </div>
    </div>
</div>
    </main>

    <!-- Footer -->
    <footer class="articles-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Sistema de Gestión</h3>
                    <p>Plataforma profesional para gestión empresarial</p>
                </div>
                <div class="footer-section">
                    <h3>Enlaces Rápidos</h3>
                    <ul>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="acercade.html">Acerca del Desarrollador</a></li>
                        <li><a href="articulos.html">Artículos</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contacto</h3>
                    <ul>
                        <li><i class="fas fa-envelope"></i> contacto@sistemagestion.com</li>
                        <li><i class="fas fa-globe"></i> www.sistemagestion.com</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Sistema de Gestión &copy; 2023. Todos los derechos reservados.</p>
                <p class="developer-credit">Desarrollado con <i class="fas fa-heart"></i> por [Tu Nombre]</p>
            </div>
        </div>
    </footer>

    <script>
        // Filtrado por categorías
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Remover clase active de todos los botones
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Agregar clase active al botón clickeado
                this.classList.add('active');
                
                const category = this.dataset.category;
                const articles = document.querySelectorAll('.article-full');
                
                // Mostrar/ocultar artículos según categoría
                articles.forEach(article => {
                    if (category === 'all' || article.dataset.category === category) {
                        article.style.display = 'flex';
                    } else {
                        article.style.display = 'none';
                    }
                });
            });
        });

        // Suscripción al newsletter
        document.querySelector('.newsletter-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = this.querySelector('input[type="email"]').value;
            alert(`¡Gracias por suscribirte con el correo: ${email}! Te hemos enviado un email de confirmación.`);
            this.reset();
        });
    </script>
    <script>
const API_BASE_URL = 'http://100.29.29.83:5000/api';
let articulos = [];
let categorias = [];
let articuloAEliminar = null;

// Verificar si el usuario está autenticado
document.addEventListener('DOMContentLoaded', () => {
    const user = JSON.parse(sessionStorage.getItem('user'));
    
    if (!user) {
        window.location.href = 'login.html';
        return;
    }
    
    // Verificar si es administrador (solo admins pueden gestionar artículos)
    const esAdmin = user.tipo_usuario === 'Administrador';
    if (!esAdmin) {
        document.getElementById('addArticleBtn').style.display = 'none';
    }
    
    // Cargar datos
    loadCategorias();
    loadArticulos();
    
    // Configurar eventos
    setupEventListeners();
});

// Configurar event listeners
function setupEventListeners() {
    // Botones principales
    document.getElementById('addArticleBtn').addEventListener('click', () => openModal());
    document.getElementById('refreshArticlesBtn').addEventListener('click', loadArticulos);
    document.getElementById('searchBtn').addEventListener('click', buscarArticulos);
    document.getElementById('clearSearchBtn').addEventListener('click', () => {
        document.getElementById('searchInput').value = '';
        loadArticulos();
    });
    
    // Buscar al presionar Enter
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') buscarArticulos();
    });
    
    // Ordenar
    document.getElementById('sortSelect').addEventListener('change', ordenarArticulos);
    
    // Modal de artículo
    document.getElementById('closeModal').addEventListener('click', closeModal);
    document.getElementById('cancelBtn').addEventListener('click', closeModal);
    document.getElementById('articleForm').addEventListener('submit', handleFormSubmit);
    
    // Modal de eliminación
    document.getElementById('closeDeleteModal').addEventListener('click', closeDeleteModal);
    document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteModal);
    document.getElementById('confirmDeleteBtn').addEventListener('click', confirmarEliminacion);
}

// Cargar categorías
async function loadCategorias() {
    try {
        const response = await fetch(`${API_BASE_URL}/familias`);
        categorias = await response.json();
        
        const select = document.getElementById('articleCategory');
        select.innerHTML = '<option value="">Seleccionar categoría...</option>';
        
        categorias.forEach(categoria => {
            const option = document.createElement('option');
            option.value = categoria.id;
            option.textContent = categoria.nombre;
            select.appendChild(option);
        });
    } catch (error) {
        console.error('Error al cargar categorías:', error);
        showMessage('Error al cargar categorías', 'error');
    }
}

// Cargar artículos
async function loadArticulos() {
    try {
        const response = await fetch(`${API_BASE_URL}/articulos`);
        articulos = await response.json();
        
        renderArticulos();
        updateStats();
    } catch (error) {
        console.error('Error al cargar artículos:', error);
        showMessage('Error al cargar artículos', 'error');
    }
}

// Buscar artículos por nombre
async function buscarArticulos() {
    const nombre = document.getElementById('searchInput').value.trim();
    
    if (!nombre) {
        loadArticulos();
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/articulos/buscar/${encodeURIComponent(nombre)}`);
        articulos = await response.json();
        
        renderArticulos();
        showMessage(`Se encontraron ${articulos.length} resultados para "${nombre}"`, 'info');
    } catch (error) {
        console.error('Error al buscar artículos:', error);
        showMessage('Error al buscar artículos', 'error');
    }
}

// Renderizar artículos en la cuadrícula
function renderArticulos() {
    const grid = document.getElementById('articlesGrid');
    const noArticlesMessage = document.getElementById('noArticlesMessage');
    
    if (articulos.length === 0) {
        grid.innerHTML = '';
        noArticlesMessage.style.display = 'block';
        return;
    }
    
    noArticlesMessage.style.display = 'none';
    
    grid.innerHTML = articulos.map(articulo => `
        <div class="article-card" data-id="${articulo.id}">
            <div class="article-card-image">
                <img src="${articulo.foto || 'assets/default.jpg'}" 
                     alt="${articulo.nombre}"
                     onerror="this.src='assets/default.jpg'">
            </div>
            <div class="article-card-content">
                <div class="article-card-header">
                    <span class="article-category">${articulo.familia_nombre}</span>
                    <span class="article-stock ${articulo.existencias < 5 ? 'stock-low' : ''}">
                        <i class="fas fa-box"></i> ${articulo.existencias} unidades
                    </span>
                </div>
                <h3 class="article-card-title">${articulo.nombre}</h3>
                <p class="article-card-description">${articulo.descripcion}</p>
                
                <div class="article-card-footer">
                    <div class="article-card-price">
                        <span class="price">$${articulo.precio.toFixed(2)}</span>
                        <span class="price-label">Precio</span>
                    </div>
                    <div class="article-card-actions">
                        <button class="btn btn-sm btn-secondary edit-article" data-id="${articulo.id}">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-sm btn-danger delete-article" data-id="${articulo.id}">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    // Agregar eventos a los botones
    document.querySelectorAll('.edit-article').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const articuloId = e.target.closest('button').dataset.id;
            editarArticulo(articuloId);
        });
    });
    
    document.querySelectorAll('.delete-article').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const articuloId = e.target.closest('button').dataset.id;
            confirmarEliminar(articuloId);
        });
    });
}

// Ordenar artículos
function ordenarArticulos() {
    const sortBy = document.getElementById('sortSelect').value;
    
    switch(sortBy) {
        case 'nombre':
            articulos.sort((a, b) => a.nombre.localeCompare(b.nombre));
            break;
        case 'precio_asc':
            articulos.sort((a, b) => a.precio - b.precio);
            break;
        case 'precio_desc':
            articulos.sort((a, b) => b.precio - a.precio);
            break;
        case 'stock':
            articulos.sort((a, b) => b.existencias - a.existencias);
            break;
        default: // id
            articulos.sort((a, b) => a.id - b.id);
    }
    
    renderArticulos();
}

// Actualizar estadísticas
function updateStats() {
    if (articulos.length === 0) {
        document.getElementById('totalArticles').textContent = '0 Artículos';
        document.getElementById('totalValue').textContent = '$0.00';
        document.getElementById('totalStock').textContent = '0 Unidades';
        return;
    }
    
    const totalArticulos = articulos.length;
    const valorTotal = articulos.reduce((sum, art) => sum + (art.precio * art.existencias), 0);
    const stockTotal = articulos.reduce((sum, art) => sum + art.existencias, 0);
    
    document.getElementById('totalArticles').textContent = `${totalArticulos} Artículos`;
    document.getElementById('totalValue').textContent = `$${valorTotal.toFixed(2)}`;
    document.getElementById('totalStock').textContent = `${stockTotal} Unidades`;
}

// Abrir modal para agregar/editar
function openModal(articulo = null) {
    const modal = document.getElementById('articleModal');
    const title = document.getElementById('modalTitle');
    const form = document.getElementById('articleForm');
    
    if (articulo) {
        title.textContent = 'Editar Artículo';
        document.getElementById('articleId').value = articulo.id;
        document.getElementById('articleName').value = articulo.nombre;
        document.getElementById('articleDescription').value = articulo.descripcion;
        document.getElementById('articleStock').value = articulo.existencias;
        document.getElementById('articlePrice').value = articulo.precio;
        document.getElementById('articleCategory').value = articulo.familia_id;
        document.getElementById('articlePhoto').value = articulo.foto || '';
    } else {
        title.textContent = 'Agregar Artículo';
        form.reset();
        document.getElementById('articleId').value = '';
    }
    
    modal.style.display = 'flex';
}

// Cerrar modal
function closeModal() {
    document.getElementById('articleModal').style.display = 'none';
}

// Manejar envío del formulario
async function handleFormSubmit(e) {
    e.preventDefault();
    
    const articuloId = document.getElementById('articleId').value;
    const formData = {
        nombre: document.getElementById('articleName').value,
        descripcion: document.getElementById('articleDescription').value,
        existencias: parseInt(document.getElementById('articleStock').value),
        precio: parseFloat(document.getElementById('articlePrice').value),
        familia_id: parseInt(document.getElementById('articleCategory').value),
        foto: document.getElementById('articlePhoto').value || 'img/default.jpg'
    };
    
    try {
        let response;
        
        if (articuloId) {
            // Actualizar artículo existente
            response = await fetch(`${API_BASE_URL}/articulos/${articuloId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
        } else {
            // Crear nuevo artículo
            response = await fetch(`${API_BASE_URL}/articulos`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
        }
        
        const result = await response.json();
        
        if (result.success) {
            showMessage(`Artículo ${articuloId ? 'actualizado' : 'creado'} correctamente`, 'success');
            closeModal();
            loadArticulos();
        } else {
            showMessage(result.error || 'Error al guardar artículo', 'error');
        }
    } catch (error) {
        console.error('Error al guardar artículo:', error);
        showMessage('Error de conexión. Intente nuevamente.', 'error');
    }
}

// Editar artículo
function editarArticulo(articuloId) {
    const articulo = articulos.find(a => a.id == articuloId);
    if (articulo) {
        openModal(articulo);
    }
}

// Confirmar eliminación
function confirmarEliminar(articuloId) {
    const articulo = articulos.find(a => a.id == articuloId);
    if (articulo) {
        articuloAEliminar = articuloId;
        document.getElementById('deleteArticleName').textContent = articulo.nombre;
        document.getElementById('deleteModal').style.display = 'flex';
    }
}

// Cerrar modal de eliminación
function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
    articuloAEliminar = null;
}

// Confirmar eliminación
async function confirmarEliminacion() {
    if (!articuloAEliminar) return;
    
    try {
        const response = await fetch(`${API_BASE_URL}/articulos/${articuloAEliminar}`, {
            method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
            showMessage('Artículo eliminado correctamente', 'success');
            closeDeleteModal();
            loadArticulos();
        } else {
            showMessage(result.error || 'Error al eliminar artículo', 'error');
        }
    } catch (error) {
        console.error('Error al eliminar artículo:', error);
        showMessage('Error de conexión. Intente nuevamente.', 'error');
    }
}

// Mostrar mensaje
function showMessage(message, type) {
    const alertDiv = document.getElementById('messageAlert');
    alertDiv.textContent = message;
    alertDiv.className = `alert alert-${type}`;
    alertDiv.style.display = 'block';
    
    setTimeout(() => {
        alertDiv.style.display = 'none';
    }, 5000);
}

// Permitir búsqueda con Enter
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        buscarArticulos();
    }
});

// Verificar si el usuario está autenticado
document.addEventListener('DOMContentLoaded', () => {
    const user = JSON.parse(sessionStorage.getItem('user'));
    
    if (!user) {
        window.location.href = 'login.html';
        return;
    }
    
    document.getElementById('userName').textContent = `${user.nombre} ${user.paterno}`;
    
    // Cargar datos
    loadTiposUsuario();
    loadUsuarios();
    
    // Configurar eventos
    setupEventListeners();
});

// Cerrar sesión
document.getElementById('logoutBtn').addEventListener('click', () => {
    sessionStorage.removeItem('user');
    window.location.href = 'login.html';
});
</script>
</body>
</html>